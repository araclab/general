model{#BEGIN OF MODEL:
  for (i in 1:N){
  for (k in 1:K){
  Y[i,k] ~ dbern(p[eta[i],k]) #observed data
  }
  eta[i] ~ dcat(pi[1:M_fit]) #Latent class assignment
  }
  
  for (j in 1:(M_fit-1)){
  exp0[j] <- exp(a[j]) #Class probabilities derived
  a[j] ~ dnorm(0,4/9) #Hyperpriors
  }
  exp0[M_fit] <- 1
  exp_sorted <- sort(exp0[1:M_fit])
  
  for (j in 1:M_fit){
  pi[j] <- exp_sorted[j]/sum(exp_sorted[1:M_fit]) #Class probabilities normalized
  for (k in 1:K){
  p[j,k] <- 1/(1+exp(-g[j,k])) # logistic , Response probabilities
  g[j,k] ~ dnorm(0,4/9) #Hyperpriors
  }
}


# # generate new data:
# for (i in 1:N){
# for (k in 1:K){
# new_Y[i,k] ~ dbern(p[new_eta[i],k])
# }
# new_eta[i] ~ dcat(pi[1:M_fit])
#}


} #END OF MODEL.
